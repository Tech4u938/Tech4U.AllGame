<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tech4U Chess Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/playroomkit"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <style>
        :root { --primary: #00d4ff; --bg: #0a0b10; --white: #ebecd0; --black: #779556; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow: hidden; }
        
        /* Profile Bar */
        #profile-bar { background: #161b22; padding: 10px; display: flex; justify-content: space-between; border-bottom: 2px solid #333; font-weight: bold; }
        .score-val { color: var(--primary); }

        /* Full Board */
        #board { 
            display: grid; grid-template-columns: repeat(8, 1fr); 
            width: 100vw; height: 100vw; max-width: 500px; max-height: 500px; 
            margin: 10px auto; border: 2px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .sq { display: flex; align-items: center; justify-content: center; font-size: 40px; cursor: pointer; position: relative; }
        .w-sq { background: var(--white); }
        .b-sq { background: var(--black); }
        .sel { background: rgba(255, 255, 0, 0.6) !important; }
        .last-move { background: rgba(155, 199, 0, 0.4); }

        /* Menu */
        #menu { padding: 40px 20px; text-align: center; }
        .logo { font-size: 32px; color: var(--primary); margin-bottom: 30px; font-weight: 800; }
        .btn { 
            width: 85%; padding: 18px; margin: 10px 0; border: none; border-radius: 12px; 
            font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .btn-online { background: var(--primary); color: #000; }
        .btn-bot { background: #a855f7; color: white; }
        
        #status { text-align: center; color: var(--primary); padding: 5px; font-weight: bold; height: 20px; }
        .hidden { display: none; }
        
        /* Mobile adjustment */
        @media (max-height: 600px) { .sq { font-size: 30px; } }
    </style>
</head>
<body>

    <!-- 1. PROFILE HEADER -->
    <div id="profile-bar" class="hidden">
        <span id="display-name">Player</span>
        <span>Wins: <span id="display-wins" class="score-val">0</span></span>
    </div>

    <!-- 2. MAIN MENU -->
    <div id="menu">
        <div class="logo">Tech4U CHESS</div>
        <div id="profile-setup" style="margin-bottom: 20px;">
            <input type="text" id="name-input" placeholder="Enter Name" style="padding: 10px; border-radius: 5px; border: none; width: 70%;">
        </div>
        <button class="btn btn-online" onclick="startGame(false)">üåê ONLINE MULTIPLAYER</button>
        <button class="btn btn-bot" onclick="startGame(true)">ü§ñ VS COMPUTER BOT</button>
    </div>

    <!-- 3. GAME AREA -->
    <div id="game-container" class="hidden">
        <div id="status">Connecting...</div>
        <div id="board"></div>
        <div style="text-align: center;">
            <button onclick="location.reload()" style="background:#222; color:#777; border:none; padding:15px; width:100%;">EXIT TO MENU</button>
        </div>
    </div>

    <script>
        const game = new Chess();
        let selectedSq = null;
        let isBot = false;
        let myName = localStorage.getItem('t4u_name') || "";
        let myWins = parseInt(localStorage.getItem('t4u_wins')) || 0;

        // Load Profile
        if (myName) {
            document.getElementById('name-input').value = myName;
            updateProfileUI();
        }

        function updateProfileUI() {
            document.getElementById('display-name').innerText = myName;
            document.getElementById('display-wins').innerText = myWins;
        }

        async function startGame(botMode) {
            const inputName = document.getElementById('name-input').value;
            if (!inputName) { alert("Please enter a name first!"); return; }
            
            myName = inputName;
            localStorage.setItem('t4u_name', myName);
            isBot = botMode;

            document.getElementById('menu').classList.add('hidden');
            document.getElementById('profile-bar').classList.remove('hidden');
            document.getElementById('game-container').classList.remove('hidden');

            if (!isBot) {
                connectMultiplayer();
            } else {
                document.getElementById('status').innerText = "Playing vs Tech4U Bot";
                draw();
            }
        }

        async function connectMultiplayer() {
            document.getElementById('status').innerText = "Connecting to Servers...";
            try {
                await Playroom.insertCoin({ 
                    gameId: "lSO33kfiKxPFBkaFheob",
                    skipLobby: true // This helps mobile connection
                });
                Playroom.setState("pName", myName);
                document.getElementById('status').innerText = "Online Ready!";
                
                setInterval(() => {
                    const fen = Playroom.getState("fen");
                    if (fen && fen !== game.fen()) {
                        game.load(fen);
                        draw();
                    }
                }, 1000);
            } catch (e) {
                document.getElementById('status').innerText = "Server Error. Bot Mode On.";
                isBot = true;
            }
            draw();
        }

        function draw() {
            const b = document.getElementById('board');
            b.innerHTML = '';
            const pos = game.board();

            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const s = pos[r][c];
                    const p = String.fromCharCode(97 + c) + (8 - r);
                    const div = document.createElement('div');
                    div.className = `sq ${(r + c) % 2 === 0 ? 'w-sq' : 'b-sq'}`;
                    if (selectedSq === p) div.classList.add('sel');

                    if (s) {
                        const icons = {'p':'‚ôü','r':'‚ôú','n':'‚ôû','b':'‚ôù','q':'‚ôõ','k':'‚ôö','P':'‚ôô','R':'‚ôñ','N':'‚ôò','B':'‚ôó','Q':'‚ôï','K':'‚ôî'};
                        div.innerText = icons[s.type];
                        div.style.color = (s.color === 'w') ? "#2b569e" : "#b53131";
                    }
                    div.onclick = () => handleMove(p);
                    b.appendChild(div);
                }
            }
        }

        function handleMove(p) {
            if (selectedSq === null) {
                const piece = game.get(p);
                if (piece && piece.color === game.turn()) {
                    selectedSq = p;
                }
            } else {
                const move = game.move({ from: selectedSq, to: p, promotion: 'q' });
                if (move) {
                    selectedSq = null;
                    if (!isBot) Playroom.setState("fen", game.fen());
                    
                    if (game.game_over()) {
                        handleWin();
                    } else if (isBot) {
                        setTimeout(makeBotMove, 600);
                    }
                } else {
                    selectedSq = null;
                }
            }
            draw();
        }

        function makeBotMove() {
            const moves = game.moves();
            if (moves.length === 0) return;
            game.move(moves[Math.floor(Math.random() * moves.length)]);
            draw();
            if (game.game_over()) alert("Game Over!");
        }

        function handleWin() {
            alert("Victory! +10 Points");
            myWins += 10;
            localStorage.setItem('t4u_wins', myWins);
            updateProfileUI();
        }
    </script>
</body>
</html>
