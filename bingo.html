<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tech4U Bingo</title>
    <script src="https://cdn.jsdelivr.net/npm/playroomkit"></script>
    <style>
        :root { --blue: #00d4ff; --bg: #0a0b10; }
        body { background: var(--bg); color: white; font-family: sans-serif; text-align: center; margin: 0; }
        
        /* B-I-N-G-O Letters */
        #bingo-status { font-size: 40px; font-weight: 900; letter-spacing: 15px; margin: 20px 0; color: #333; }
        .active-letter { color: var(--blue) !important; text-shadow: 0 0 10px var(--blue); }

        /* 5x5 Grid */
        #grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); 
            width: 95vw; max-width: 400px; height: 95vw; max-height: 400px; 
            margin: 0 auto; gap: 5px; background: #333; padding: 5px; border-radius: 10px;
        }
        .cell { 
            background: #161b22; display: flex; align-items: center; justify-content: center; 
            font-size: 24px; font-weight: bold; cursor: pointer; border-radius: 5px;
        }
        .marked { background: var(--blue) !important; color: black; }
        
        .setup-msg { color: var(--blue); padding: 20px; }
        .btn { background: var(--blue); color: black; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h1 style="color:var(--blue)">Setup Your Board</h1>
        <p>Click cells to fill numbers 1 to 25</p>
        <div id="setup-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); width: 90vw; max-width: 350px; margin: 0 auto; gap: 5px;"></div>
        <button id="start-btn" class="btn hidden" onclick="startPlay()">I'M READY TO PLAY</button>
    </div>

    <div id="play-screen" class="hidden">
        <div id="bingo-status">
            <span id="b">B</span><span id="i">I</span><span id="n">N</span><span id="g">G</span><span id="o">O</span>
        </div>
        <div id="turn-display" style="color:var(--blue); margin-bottom: 10px;">Waiting for players...</div>
        <div id="grid"></div>
        <button class="btn" onclick="location.href='index.html'" style="background:#222; color:white;">EXIT</button>
    </div>

<script>
    const { insertCoin, myPlayer, onPlayerJoin, setState, getState } = Playroom;
    let myBoard = Array(25).fill(null);
    let markedIndices = [];
    let nextNum = 1;

    // --- SETUP PHASE ---
    const setupGrid = document.getElementById('setup-grid');
    for (let i = 0; i < 25; i++) {
        const cell = document.createElement('div');
        cell.style = "height:60px; background:#161b22; border:1px solid #333; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold; cursor:pointer;";
        cell.onclick = () => {
            if (myBoard[i] === null) {
                myBoard[i] = nextNum;
                cell.innerText = nextNum;
                cell.style.color = "#00d4ff";
                nextNum++;
                if (nextNum > 25) document.getElementById('start-btn').classList.remove('hidden');
            }
        };
        setupGrid.appendChild(cell);
    }

    async function startPlay() {
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('play-screen').classList.remove('hidden');
        
        await insertCoin({ gameId: "lSO33kfiKxPFBkaFheob" });
        renderBoard();

        // Listen for number calls
        setInterval(() => {
            const lastCalled = getState("lastCalled");
            if (lastCalled) markNumber(lastCalled);
            checkWin();
        }, 1000);
    }

    function renderBoard() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        myBoard.forEach((num, index) => {
            const cell = document.createElement('div');
            cell.className = "cell" + (markedIndices.includes(index) ? " marked" : "");
            cell.innerText = num;
            cell.onclick = () => callNumber(num);
            grid.appendChild(cell);
        });
    }

    function callNumber(num) {
        setState("lastCalled", num);
    }

    function markNumber(num) {
        const index = myBoard.indexOf(num);
        if (index !== -1 && !markedIndices.includes(index)) {
            markedIndices.push(index);
            renderBoard();
        }
    }

    function checkWin() {
        let lines = 0;
        const m = markedIndices;

        // Rows
        for (let r = 0; r < 5; r++) {
            let row = [r*5, r*5+1, r*5+2, r*5+3, r*5+4];
            if (row.every(i => m.includes(i))) lines++;
        }
        // Columns
        for (let c = 0; c < 5; c++) {
            let col = [c, c+5, c+10, c+15, c+20];
            if (col.every(i => m.includes(i))) lines++;
        }
        // Diagonals
        if ([0, 6, 12, 18, 24].every(i => m.includes(i))) lines++;
        if ([4, 8, 12, 16, 20].every(i => m.includes(i))) lines++;

        // Update Letters
        if (lines >= 1) document.getElementById('b').classList.add('active-letter');
        if (lines >= 2) document.getElementById('i').classList.add('active-letter');
        if (lines >= 3) document.getElementById('n').classList.add('active-letter');
        if (lines >= 4) document.getElementById('g').classList.add('active-letter');
        if (lines >= 5) {
            document.getElementById('o').classList.add('active-letter');
            document.getElementById('turn-display').innerText = "ðŸŽ‰ BINGO! YOU WIN! ðŸŽ‰";
        }
    }
</script>
</body>
</html>
